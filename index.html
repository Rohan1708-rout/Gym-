<!DOCTYPE html>
<html>
<head>
<title>Booking</title>
<style>
body{font-family:Arial;max-width:400px;margin:40px auto;}
input,select,button{width:100%;padding:8px;margin:8px 0;}
</style>
</head>
<body>

<h2>Book a time slot</h2>

<input id="name" placeholder="Your name">
<input id="email" type="email" placeholder="Your email">
<input id="date" type="date">

<select id="time"></select>

<button onclick="book()">Book</button>

<p id="msg"></p>

<script>

const API_URL =
"https://script.google.com/macros/s/AKfycbyYYJVtEKso8Zg8hlH_2W1-5GgljGMYG9B9Cpw6q1Z_nf6SriMvKeQvDX2E2aSMc_x0yg/exec";


const timeSelect = document.getElementById("time");

function generateSlots(start="09:00",end="21:00",step=30){

  const toMin = t=>{
    const p=t.split(":");
    return (+p[0])*60+(+p[1]);
  };

  let c=toMin(start);
  const e=toMin(end);

  while(c<=e){
    const h=String(Math.floor(c/60)).padStart(2,"0");
    const m=String(c%60).padStart(2,"0");

    const o=document.createElement("option");
    o.value=h+":"+m;
    o.textContent=h+":"+m;
    timeSelect.appendChild(o);

    c+=step;
  }
}

generateSlots();


async function book(){

  const data={
    name:document.getElementById("name").value.trim(),
    email:document.getElementById("email").value.trim(),
    date:document.getElementById("date").value,
    time:document.getElementById("time").value
  };

  if(!data.name||!data.email||!data.date||!data.time){
    msg("Fill all fields");
    return;
  }

  try{

    const res = await fetch(API_URL,{
      method:"POST",
      headers:{
        "Content-Type":"application/json"
      },
      body:JSON.stringify(data)
    });

    const r = await res.json();

    if(r.status !== "ok"){
      throw r;
    }

    msg("Booking successful. Check your email.");

  }catch(err){
    console.error(err);
    msg("Error. Please try again.");
  }
}

function msg(t){
  document.getElementById("msg").innerText=t;
}

</script>

</body>
</html>
